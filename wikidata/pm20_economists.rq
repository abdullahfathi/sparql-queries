# Show pm20 folders for persons of a certain occupation
#
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX schema: <http://schema.org/>
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
#
select distinct ?wd ?wdLabel ?country ?countryLabel ?pm20 ?pm20Label ?viewer ?viewerLabel
where {
  values (?occupation) {
    ( wd:Q188094 ) # economist
  }
  ?wd wdt:P106 ?occupation ;
      wdt:P4293 ?pm20Id ;
      rdfs:label ?labelLang .
  filter(lang(?labelLang) = 'en')
  bind(str(?labelLang) as ?wdLabel)
  #
  # country
  optional {
    ?wd wdt:P27 ?country .
    ?country rdfs:label ?countryLabelLang .
    filter(lang(?countryLabelLang) = 'en')
    bind(str(?countryLabelLang) as ?countryLabel)
  }
  # pm20 entry
  bind(uri(concat('http://purl.org/pressemappe20/folder/', ?pm20Id)) as ?pm20)
  bind(?pm20Id as ?pm20Label)
  #
  # viewer link
  bind(substr(?pm20Id, 4, 4) as ?numStub)
  bind(substr(?pm20Id, 4, 6) as ?num)
  bind(uri(concat('http://dfg-viewer.de/show/?tx_dlf[id]=http://zbw.eu/beta/pm20mets/pe/', ?numStub, 'xx/', ?num, '.xml')) as ?viewer)
  bind('view' as ?viewerLabel)
}
